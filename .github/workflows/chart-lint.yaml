---
  # yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
  name: "Chart Lint"

  on:
    workflow_dispatch:
    push:
      branches: ["main"]
    pull_request:
      branches: ["main"]

  concurrency:
    group: ${{ github.workflow }}-${{ github.event.number || github.ref }}
    cancel-in-progress: true

  jobs:
    lint:
      name: Lint
      runs-on: ubuntu-latest
      steps:
        - name: Generate Token
          uses: actions/create-github-app-token@v1
          id: app-token
          with:
            app-id: "${{ secrets.BOT_APP_ID }}"
            private-key: "${{ secrets.BOT_APP_PRIVATE_KEY }}"
  
        - name: Checkout
          uses: actions/checkout@v4
          with:
            token: "${{ steps.app-token.outputs.token }}"
    
        - name: Lint Helm charts
          uses: helm/chart-testing-action@v1.0.0
          with:
            command: lint
            config: ct.yaml
